<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <title>パストレーシングのテスト</title>
    <link rel="stylesheet" href="style.css" media="all" type="text/css" />
    <script type="text/javascript" src="js/lib/numeric.js"></script> <!-- TODO: test -->
</head>
<body>
<canvas id="out" width="800" height="600" style="width: 800; height: 600; background: linear-gradient(cyan, black);"></canvas>

<label for="samples">サンプル数</label>
<input type="text" id="samples" value="8" />

<span id="status">initialize...</span>

<script type="text/javascript">
    function status(s) {
        var stat = document.getElementById("status");
        stat.textContent = s;
    }

    function render(y) {
        worker.postMessage({
            "imageData": canvasCtx.createImageData(canvas.width, 1),
            "width": canvas.width,
            "height": canvas.height,
            "samples": samples,
            "y": y
        });
    }

    var worker = new Worker("worker.js"),
            canvas = document.getElementById("out"),
            canvasCtx = canvas.getContext("2d"),
            samples = document.getElementById("samples").value,
            y = 0;

    worker.addEventListener('message', function(e) {
        canvasCtx.putImageData(e.data, 0, y);
        ++y;
        if (y < canvas.height) {
            render(y);
        }
    }, false);

    render(y);
</script>

</body>
</html>
